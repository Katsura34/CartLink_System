<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - CartLink System</title>
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="logo">ðŸ›’ CartLink</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="products.html">Products</a></li>
                <li><a href="cart.html">Cart <span class="cart-badge">0</span></a></li>
                <li id="auth-links"></li>
            </ul>
        </nav>
    </header>

    <div class="container" style="margin-top: 2rem;">
        <h1 class="mb-3">Shopping Cart</h1>

        <div id="cart-container"></div>
        
        <div id="empty-cart" class="card text-center" style="display: none;">
            <h2>Your cart is empty</h2>
            <p>Add some products to get started!</p>
            <a href="products.html" class="btn btn-primary">Browse Products</a>
        </div>
    </div>

    <script src="../assets/js/main.js"></script>
    <script>
        // Update navigation based on auth status
        const authLinks = document.getElementById('auth-links');
        if (Auth.isAuthenticated()) {
            const user = Auth.getUser();
            authLinks.innerHTML = `
                <li><a href="orders.html">My Orders</a></li>
                <li><a href="#" id="logout-btn">Logout (${user.username})</a></li>
            `;
        } else {
            authLinks.innerHTML = `
                <li><a href="login.html">Login</a></li>
                <li><a href="register.html">Register</a></li>
            `;
        }

        function displayCart() {
            const cartItems = Cart.getItems();
            const container = document.getElementById('cart-container');
            const emptyCart = document.getElementById('empty-cart');
            
            if (cartItems.length === 0) {
                container.innerHTML = '';
                emptyCart.style.display = 'block';
                return;
            }
            
            emptyCart.style.display = 'none';
            
            const total = Cart.getTotal();
            
            container.innerHTML = `
                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Subtotal</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${cartItems.map(item => `
                                <tr>
                                    <td>${item.name}</td>
                                    <td>$${item.price.toFixed(2)}</td>
                                    <td>
                                        <input 
                                            type="number" 
                                            value="${item.quantity}" 
                                            min="1" 
                                            style="width: 80px; padding: 0.5rem;"
                                            onchange="updateQuantity(${item.id}, this.value)"
                                            class="form-control"
                                        >
                                    </td>
                                    <td>$${(item.price * item.quantity).toFixed(2)}</td>
                                    <td>
                                        <button onclick="removeItem(${item.id})" class="btn btn-danger">Remove</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 2rem; text-align: right;">
                        <h2>Total: $${total.toFixed(2)}</h2>
                        <div style="margin-top: 1rem;">
                            <a href="products.html" class="btn btn-secondary">Continue Shopping</a>
                            <a href="checkout.html" class="btn btn-primary" style="margin-left: 1rem;">Proceed to Checkout</a>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateQuantity(productId, quantity) {
            quantity = parseInt(quantity);
            if (quantity > 0) {
                Cart.updateQuantity(productId, quantity);
                displayCart();
                showAlert('Cart updated', 'success');
            }
        }

        function removeItem(productId) {
            if (confirm('Remove this item from cart?')) {
                Cart.removeItem(productId);
                displayCart();
                showAlert('Item removed from cart', 'success');
            }
        }

        displayCart();
    </script>
</body>
</html>
